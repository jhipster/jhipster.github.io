---
layout: default
title: Docker Compose
sitemap:
    priority: 0.7
    lastmod: 2015-12-24T00:00:00-00:00
---

# <i class="fa fa-music"></i> [BETA] Docker Compose

__WARNING!__ This is a new feature, currently in __BETA__. Only these containers are available: MySQL, PostgreSQL, MongoDB, Cassandra, Elasticsearch, SonarQube

## Description

When generating your application, if you choose MySQL, PostgreSQL, MongoDB or Cassandra, a `docker-compose.yml` or `docker-compose-prod.yml` file is generated in your folder project.

If you choose Elasticsearch as search engine, the configuration will be included in `docker-compose-prod.yml`.

So you can use docker-compose to start your database in development or production profile.

All these images come from the official [Docker Hub](https://hub.docker.com/):

- [MySQL](https://hub.docker.com/_/mysql/)
- [PostgreSQL](https://hub.docker.com/_/postgres/)
- [MongoDB](https://hub.docker.com/_/mongo/)
- [Cassandra](https://hub.docker.com/_/cassandra/)
- [Elasticsearch](https://hub.docker.com/_/elasticsearch/)
- [SonarQube](https://hub.docker.com/_/sonarqube/)

## Prerequisites

You have to install Docker and Docker Compose:

- [Docker](https://docs.docker.com/installation/#installation)
- [Docker Compose](https://docs.docker.com/compose/install)

## Working with databases

### Starting MySQL, PostgreSQL or MongoDB

**In development profile**:

`docker-compose up -d`

**In production profile** (it will start Elasticsearch too if you selected it as search engine):

`docker-compose -f docker-compose-prod.yml up -d`

### Starting Cassandra the first time

**In development profile**:

- Build the image, which will contain the CQL scripts generated by your project for initializing the database:

`docker-compose build`

- Start the container (it will show the container id):

`docker-compose up -d`

- Initialize the database by creating the Keyspace and the Tables:

`docker exec -it "container id" init`

**In production profile**:

- Build the image:

`docker-compose -f docker-compose-prod.yml build`

- Start the container (it will show the container id):

`docker-compose -f docker-compose-prod.yml up -d`

- Initialize the database by creating the Keyspace and the Tables:

`docker exec -it "container id" init`

- Add X other nodes:

`docker-compose -f docker-compose-prod.yml scale <name_of_your_app>-cassandra-node=X`

- You can manage all nodes with OpsCenter: [http://localhost:8888](http://localhost:8888)

- Before starting your application in production profile, add in your `application-prod.yml` every IP of containers to the key `spring.data.cassandra.contactPoints`

### Starting Cassandra the next times

**In development profile**:

`docker-compose up -d`

**In production profile**:

`docker-compose -f docker-compose-prod.yml up -d`

## Working with Sonar

When generating your application, the `docker/sonar.yml` is generated in your folder project.
So you can start a sonar instance to analyze your code:

Start a sonar instance :

`docker-compose -f docker/sonar.yml up -d`

Analyze your code:

`mvn sonar:sonar` or `./gradlew sonar`

You can access to sonar: [http://localhost:9000](http://localhost:9000)


## Common commands

### List the containers

You can use `docker ps -a` to list all the containers

    $ docker ps -a
    CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
    fc35e1090021        mysql               "/entrypoint.sh mysql"   4 seconds ago       Up 4 seconds        0.0.0.0:3306->3306/tcp   sampleApplication-prod-mysql


### Stop the containers

In development profile:

`docker-compose stop`

In production profile:

`docker-compose -f docker-compose-prod.yml stop`

You can use directly docker:

`docker stop "container id"`

When you stop a container, the data are not deleted, unless you delete the container.

### Delete a container

Be carefull! All data will be deleted:

`docker rm "container id"`
